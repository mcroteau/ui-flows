<!doctype html>
<html>
	<head>
		<title>jsPlumb 1.3.3 - draggable connectors experiments - jQuery</title>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<link rel="stylesheet" href="css/jsPlumbDemo.css">
		<link rel="stylesheet" href="css/draggableConnectorsDemo.css">
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js"></script>
		<script type="text/javascript" src="js/jquery.jsPlumb-1.3.3-all.js"></script>		
		<!--  demo code -->
		<script type="text/javascript" src="js/draggableConnectorsDemo.js"></script>
		<script type="text/javascript" src="js/draggableConnectorsDemo-jquery.js"></script>		
		<!--  demo helper code -->
		<script type="text/javascript" src="js/demo-helper-jquery.js"></script>
		
		<!--  demo helper code -->
		<link rel="stylesheet" href="css/UIFlow.UserActions.css">
		<script type="text/javascript" src="js/mustache.js"></script>
		<script type="text/javascript" src="js/Utilities.js"></script>
		<script type="text/javascript" src="js/interactions/UIFlow.UserActions.js"></script>
		
		<style>
			ul{margin:0 0 10px 0;padding:0;list-style:none;}
			ul li{/*padding-bottom:5px;margin-bottom:5px*/}
			.newChoice{display:block;text-align:center;x-margin-bottom:10px;}
			.window{height:auto;width:250px;padding:0;}
			.poop{}
			.window span{display:block;height:15px;background:#ccc;}
		</style>
	</head>
	<body onunload="jsPlumb.unload();">
		<div id="demo">
			<div class="window" id="window1">
				<span></span>
				<p contenteditable="true">This is what the user sees</p>
				<!--
				one<br/><br/>
				<a href="#" class="cmdLink hide" rel="window1">toggle connections</a>
				<br/>
				<a href="#" class="cmdLink drag" rel="window1">disable dragging</a>
				<br/>
				<a href="#" class="cmdLink detach" rel="window1">detach all</a>
				-->
				<ul>
				</ul>
				<a href="#" class="newChoice">Add New Item</a>
			</div>
			<div class="window" id="window2">
			<span></span>
			two<br/><br/><a href="#" class="cmdLink hide" rel="window2">toggle connections</a><br/><a href="#" class="cmdLink drag" rel="window2">disable dragging</a><br/><a href="#" class="cmdLink detach" rel="window2">detach all</a></div>
			<!--div class="window" id="window3">three<br/><br/><a href="#" class="cmdLink hide" rel="window3">toggle connections</a><br/><a href="#" class="cmdLink drag" rel="window3">disable dragging</a><br/><a href="#" class="cmdLink detach" rel="window3">detach all</a></div>
			<div class="window" id="window4">four<br/><br/><a href="#" class="cmdLink hide" rel="window4">toggle connections</a><br/><a href="#" class="cmdLink drag" rel="window4">disable dragging</a><br/><a href="#" class="cmdLink detach" rel="window4">detach all</a></div-->
		</div>
		
		<script>
			function getEventTarget(e){
				var e=e || window.event;
				return e.target || e.srcElement;
			}
			
			jsPlumb.Defaults.Container = $("body");
			
			var exampleDropOptions = {
				tolerance:'touch',
				hoverClass:'dropHover',
				activeClass:'dragActive'
			};
			var color2 = "#316b31";
			var exampleEndpoint2 = {
					endpoint:["Dot", { radius:5 }],
					//endpoint:"Blank",
					paintStyle:{ fillStyle:color2 },
					isSource:true,
					scope:"green dot",
					connectorStyle:{ strokeStyle:color2, lineWidth:2 },
					connector: ["Bezier", { curviness:63 } ],
					maxConnections:3,
					isTarget:true,
					dropOptions : exampleDropOptions
			};

			$('a.newChoice').bind('click',function(e){
				e.preventDefault()
				var target=getEventTarget(e);
				if(target && target.nodeName.toLowerCase() === "a"){
					var targ = $(target).prev('ul').append("<li contenteditable=\"true\">New User Action</li>");
					var addedItem = targ.find('li').last();
					//console.info('height:'+targ.parent('.window').height())
					//console.info('offset:'+addedItem.position().top)
					var offset = addedItem.position().top/targ.parents('.window').height();
					console.info(offset);
					jsPlumb.addEndpoint(addedItem, {anchor:"RightMiddle"},exampleEndpoint2);
					
					
					//jsPlumb.connect({source:"window1",target:"window2",anchors:[[1,offset,1,1],"TopLeft"]});
					
					
				}
				
			})
			
			foo = function(){
				jsPlumb.addEndpoint('window2', { anchor:[0,0.2,0,0] }, exampleEndpoint2);
			}
			
			
			
			
			$('.window').draggable({handle:'span'}).live('drag',function(e){
				jsPlumb.repaintEverything()
			})
			
			$('[contenteditable]').live('focus', function() {
			    var $this = $(this);
			    $this.data('before', $this.html());
			}).live('blur', function() {
			    var $this = $(this);
			    if($this.data('before') === $this.html()){
			    	console.info('there has not been a change')
			    }
			    if($this.html().length <= 4){
			    	$this.remove()
			    }
			}).live('keyup',jsPlumb.repaintEverything);
			
		</script>
		
		
	</body>
</html>